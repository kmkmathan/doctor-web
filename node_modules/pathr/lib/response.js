'use strict';

/**
 *	Send a response back
 */
module.exports = function(req, res, config) {
	var file, data;
	if (config.view) {
		try {
			file = this.viewEngine(viewPath(this.viewsPath, config.view), res.locals);
		} catch (e) {
			res.writeHead(500, {
				'Content-Type': 'text/plain',
				'Content-Length': e.length,
			});
			return res.end(e);
		};
		
		res.writeHead(200, {
			'Content-Type': 'text/html',
			'Content-Length': file.length,
		});

		return res.end(file);
	} else {
		data = JSON.stringify(res.locals);
		res.writeHead(200, {
			'Content-Type': 'text/json',
			'Content-Length': data.length,
		});
		return res.end(data);
	};
};

/**
 *	Create a view file path
 *	@param {String} base
 *	@param {String} file
 *	@return {String}
 */
var viewPath = function(base, file) {
	var str = base;
	
	if (str[str.length - 1] != '/') str += '/';
	if (file.indexOf('.jade') == -1) file += '.jade';

	return str+file;
};
